!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-TagsInput requires a Window.");if(!("UI"in t))throw new Error("FrostUI-TagsInput requires FrostUI.");const e=t.Core,s=t.DOM,i=t.dom,n=t.UI,a=t.document;class o extends n.BaseComponent{constructor(t,s){if(super(t,s),!i.is(this._node,"select"))throw new Error("TagsInput must be created on a select element");let n;this._placeholderText=this._settings.placeholder,this._maxSelections=this._settings.maxSelections,this._data=[],this._value=null,this._getData=null,this._getResults=null,e.isFunction(this._settings.getResults)?(this._getResultsCallbackInit(),this._getResultsInit()):e.isArray(this._settings.data)&&(n=this._settings.data),n&&(this._data=this.constructor._parseData(n),this._getDataInit());const a=[...this._node.selectedOptions].map((t=>i.getValue(t)));this._render(),this._setValue(a),this._events()}disable(){return i.setAttribute(this._node,"disabled",!0),this._refreshDisabled(),this}dispose(){this._popper&&(this._popper.dispose(),this._popper=null),i.removeAttribute(this._node,"tabindex"),i.removeEvent(this._node,"focus.ui.tagsinput"),i.removeClass(this._node,this.constructor.classes.hide),i.remove(this._menuNode),i.remove(this._toggle),this._toggle=null,this._clear=null,this._input=null,this._placeholder=null,this._menuNode=null,this._itemsList=null,this._data=null,this._value=null,this._request=null,this._popperOptions=null,super.dispose()}enable(){return i.removeAttribute(this._node,"disabled"),this._refreshDisabled(),this}hide(){return!this._animating&&i.isConnected(this._menuNode)&&i.triggerOne(this._node,"hide.ui.tagsinput")?(this._animating=!0,this._refreshPlaceholder(),i.fadeOut(this._menuNode,{duration:this._settings.duration}).then((t=>{this._popper.dispose(),this._popper=null,i.empty(this._itemsList),i.detach(this._menuNode),i.setAttribute(this._toggle,"aria-expanded",!1),i.triggerEvent(this._node,"hidden.ui.tagsinput")})).catch((t=>{})).finally((t=>{this._animating=!1})),this):this}show(){return i.is(this._node,":disabled")||i.hasAttribute(this._node,"readonly")||!this._getData||this._animating||i.isConnected(this._menuNode)||!i.triggerOne(this._node,"show.ui.tagsinput")||(this._getData({}),this._animating=!0,this._settings.appendTo?i.append(this._settings.appendTo,this._menuNode):i.after(this._toggle,this._menuNode),this._popper=new n.Popper(this._menuNode,this._popperOptions),i.fadeIn(this._menuNode,{duration:this._settings.duration}).then((t=>{i.setAttribute(this._toggle,"aria-expanded",!0),i.triggerEvent(this._node,"shown.ui.tagsinput")})).catch((t=>{})).finally((t=>{this._animating=!1}))),this}toggle(){return i.isConnected(this._menuNode)?this.hide():this.show()}update(){return this._popper&&this._popper.update(),this}}Object.assign(o.prototype,{add(t){return i.is(this._node,":disabled")||(this._settings.trimValue&&(t=t.trim()),this._setValue(this._value.concat([t]),!0)),this},getMaxSelections(){return this._maxSelections},getPlaceholder(){return this._placeholderText},getValue(){return this._value},remove(t){return i.is(this._node,":disabled")||this._setValue(this._value.filter((e=>e!==t)),!0),this},removeAll(){return i.is(this._node,":disabled")||this._setValue([],!0),this},setMaxSelections(t){return this._maxSelections=t,this.hide(),this._refresh(),this},setPlaceholder(t){return this._placeholderText=t,i.remove(this._placeholder),this._renderPlaceholder(),this._refresh(),this},setValue(t){return i.is(this._node,":disabled")||this._setValue(t,!0),this}}),Object.assign(o.prototype,{_events(){i.addEventDelegate(this._menuNode,"contextmenu.ui.tagsinput",'[data-ui-action="select"]',(t=>{t.preventDefault()})),i.addEvent(this._menuNode,"mousedown.ui.tagsinput",(t=>{i.isSame(this._input,t.target)||t.preventDefault()})),i.addEvent(this._menuNode,"click.ui.tagsinput",(t=>{t.stopPropagation()})),i.addEvent(this._node,"focus.ui.tagsinput",(t=>{i.isSame(this._node,a.activeElement)&&i.focus(this._input)})),i.addEventDelegate(this._itemsList,"mouseup.ui.tagsinput",'[data-ui-action="select"]',(t=>{t.preventDefault(),i.setValue(this._input,"");const e=i.getDataset(t.currentTarget,"uiValue");this._selectValue(e)})),i.addEventDelegate(this._itemsList,"mouseover.ui.tagsinput",'[data-ui-action="select"]',s.debounce((t=>{const e=i.find("[data-ui-focus]",this._itemsList);i.removeClass(e,this.constructor.classes.focus),i.removeDataset(e,"uiFocus"),i.addClass(t.currentTarget,this.constructor.classes.focus),i.setDataset(t.currentTarget,"uiFocus",!0)}))),i.addEvent(this._input,"focus.ui.tagsinput",(t=>{i.isSame(this._input,a.activeElement)&&(i.hide(this._placeholder),i.detach(this._placeholder),i.addClass(this._toggle,"focus"))}));let n=!1;i.addEvent(this._input,"blur.ui.tagsinput",(t=>{if(i.isSame(this._input,a.activeElement))return;if(n)return;const e=i.getValue(this._input);e&&(this._settings.confirmOnBlur&&this.add(e),(this._settings.confirmOnBlur||this._settings.clearOnBlur)&&i.setValue(this._input,"")),i.removeClass(this._toggle,"focus"),i.isConnected(this._menuNode)?(i.stop(this._menuNode),this._animating=!1,this.hide()):this._refreshPlaceholder()}));const o=e.debounce((t=>{this._getData({term:t})}),this._settings.debounceInput);i.addEvent(this._input,"input.ui.tagsinput",s.debounce((t=>{if(this._updateSearchWidth(),!this._getData)return;this.show();const e=i.getValue(this._input);o(e)}))),i.addEvent(this._input,"keydown.ui.tagsinput",(t=>{if(this._settings.confirmKeys.includes(t.key)){t.preventDefault();const e=i.getValue(this._input);return this.add(e),i.setValue(this._input,""),void i.focus(this._input)}if(!["ArrowDown","ArrowUp","Backspace","Enter"].includes(t.code))return;if("Backspace"===t.code)return void(this._value.length&&!i.getValue(this._input)&&(t.preventDefault(),this._value.pop(),this._refresh(),i.setValue(this._input,""),i.focus(this._input),this._updateSearchWidth(),i.triggerEvent(this._input,"input.ui.tagsinput")));if(!i.isConnected(this._menuNode)&&["ArrowDown","ArrowUp"].includes(t.code))return this.show();const e=i.findOne("[data-ui-focus]",this._itemsList);if("Enter"===t.code){let t;return e?(t=i.getDataset(e,"uiValue"),i.setValue(this._input,"")):t=i.getValue(this._input),this.add(t),i.setValue(this._input,""),void i.focus(this._input)}let s;if(e)switch(t.code){case"ArrowDown":s=i.nextAll(e,'[data-ui-action="select"]').shift();break;case"ArrowUp":s=i.prevAll(e,'[data-ui-action="select"]').pop()}else s=i.findOne('[data-ui-action="select"]',this._itemsList);if(!s)return;i.removeClass(e,this.constructor.classes.focus),i.removeDataset(e,"uiFocus"),i.addClass(s,this.constructor.classes.focus),i.setDataset(s,"uiFocus",!0);const n=i.getScrollY(this._itemsList),a=i.rect(this._itemsList,!0),o=i.rect(s,!0);o.top<a.top?i.setScrollY(this._itemsList,n+o.top-a.top):o.bottom>a.bottom&&i.setScrollY(this._itemsList,n+o.bottom-a.bottom)})),i.addEvent(this._input,"keyup.ui.tagsinput",(t=>{"Escape"===t.code&&i.isConnected(this._menuNode)&&(t.stopPropagation(),this.hide(),i.blur(this._input),i.focus(this._input))})),this._settings.getResults&&i.addEvent(this._itemsList,"scroll.ui.tagsinput",e.throttle((t=>{if(this._request||!this._showMore)return;const e=i.height(this._itemsList),n=i.height(this._itemsList,s.SCROLL_BOX);if(i.getScrollY(this._itemsList)>=n-e-e/4){const t=i.getValue(this._input),e=this._data.length;this._getData({term:t,offset:e})}}),250,!1)),i.addEvent(this._toggle,"mousedown.ui.tagsinput",(e=>{i.is(e.target,'[data-ui-action="clear"]')?e.preventDefault():(i.hasClass(this._toggle,"focus")?n=!0:(i.hide(this._placeholder),i.addClass(this._toggle,"focus")),i.addEventOnce(t,"mouseup.ui.tagsinput",(t=>{n=!1,i.focus(this._input),e.button||this.show()})))})),i.addEventDelegate(this._toggle,"click.ui.tagsinput",'[data-ui-action="clear"]',(t=>{if(t.button)return;const e=i.parent(t.currentTarget),s=i.index(e),n=this._value.slice();n.splice(s,1),this._setValue(n,!0),i.focus(this._input)}))}}),Object.assign(o.prototype,{_findValue(t){if(!t)return null;for(const e of this._data)if(e.value===t)return e;return{value:t,element:this.constructor._buildOption(t)}},_refresh(){if(this._value||(this._value=[]),this._maxSelections&&this._value.length>this._maxSelections&&(this._value=this._value.slice(0,this._maxSelections)),this._value=e.unique(this._value),i.detach(this._input),i.empty(this._node),i.empty(this._toggle),this._refreshDisabled(),this._refreshPlaceholder(),this._value.length)for(const t of this._value){const e=this._findValue(t);i.append(this._node,e.element);const s=this._renderSelection(e);i.append(this._toggle,s)}i.append(this._toggle,this._input)},_refreshDisabled(){const t=this._input;i.is(this._node,":disabled")?(i.addClass(this._toggle,this.constructor.classes.disabled),i.setAttribute(t,"tabindex","-1")):(i.removeClass(this._toggle,this.constructor.classes.disabled),i.removeAttribute(t,"tabindex")),i.hasAttribute(this._node,"readonly")&&i.addClass(this._toggle,this.constructor.classes.readonly)},_refreshPlaceholder(){this._value.length?i.hide(this._placeholder):(i.show(this._placeholder),i.prepend(this._toggle,this._placeholder))},_selectValue(t){const e=this._findValue(t);if(!e)return this._refresh();t=e.value,t=this._value.concat([t]),this._setValue(t,!0),this._settings.closeOnSelect?this.hide():this._getData&&this._getData({}),this._refreshPlaceholder(),i.setValue(this._input,""),i.focus(this._input)},_setValue(t,e=!1){t=t.filter(this._settings.validTag),this._value&&t.length===this._value.length&&t.every(((t,e)=>t===this._value[e]))||(this._value=t,this._refresh(),e&&i.triggerEvent(this._node,"change.ui.tagsinput"))},_updateSearchWidth(){const t=i.create("span",{text:i.getValue(this._input),style:{display:"inline-block",fontSize:i.css(this._input,"fontSize"),whiteSpace:"pre-wrap"}});i.append(a.body,t);const e=i.width(t);i.setStyle(this._input,"width",e+2),i.remove(t)}}),Object.assign(o.prototype,{_getDataInit(){this._getData=({term:t=null})=>{if(i.empty(this._itemsList),this._settings.minSearch&&(!t||t.length<this._settings.minSearch))return this.update();if(this._maxSelections&&this._value.length>=this._maxSelections)return this._renderInfo(this._settings.lang.maxSelections);const e=this._settings.sortResults(this._data,t).filter((e=>this._settings.isMatch(e.value,t)));this._renderResults(e),this.update()}},_getResultsInit(){this._getData=({offset:t=0,term:e=null})=>{if(this._request&&this._request.cancel&&(this._request.cancel(),this._request=null),t||i.empty(this._itemsList),this._settings.minSearch&&(!e||e.length<this._settings.minSearch))return this.update();if(this._maxSelections&&this._value.length>=this._maxSelections)return this._renderInfo(this._settings.lang.maxSelections);const s={offset:t};e&&(s.term=e);const n=this._renderInfo(this._settings.lang.loading),a=this._getResults(s);a.then((t=>{this._renderResults(t.results)})).catch((t=>{})).finally((t=>{i.remove(n),this.update(),this._request===a&&(this._request=null)}))}},_getResultsCallbackInit(){this._getResults=t=>{t.offset||(this._data=[]);const e=this._settings.getResults(t);return this._request=Promise.resolve(e),this._request.then((t=>{const e=this.constructor._parseData(t.results);return this._data.push(...e),this._showMore=t.showMore,t.results=t.results.map((t=>({value:t}))),t})),this._request}}}),Object.assign(o.prototype,{_render(){this._renderToggle(),this._renderPlaceholder(),this._renderMenu(),i.addClass(this._node,this.constructor.classes.hide),i.setAttribute(this._node,"tabindex","-1"),i.after(this._node,this._toggle)},_renderInfo(t){const e=i.create("button",{html:this._settings.sanitize(t),class:this.constructor.classes.info,attributes:{type:"button"}});return i.append(this._itemsList,e),this.update(),e},_renderItem(t){const e=this._value.includes(t.value),s=i.create("div",{html:this._settings.sanitize(this._settings.renderResult(t.value,e)),class:this.constructor.classes.item});return e&&(i.addClass(s,this.constructor.classes.active),i.setDataset(s,"uiActive",!0)),t.disabled?i.addClass(s,this.constructor.classes.disabledItem):(i.addClass(s,this.constructor.classes.action),i.setDataset(s,{uiAction:"select",uiValue:t.value})),s},_renderMenu(){this._menuNode=i.create("div",{class:this.constructor.classes.menu}),this._itemsList=i.create("div",{class:this.constructor.classes.items}),i.append(this._menuNode,this._itemsList),this._popperOptions={reference:this._toggle,placement:this._settings.placement,position:this._settings.position,fixed:this._settings.fixed,spacing:this._settings.spacing,minContact:this._settings.minContact},this._settings.fullWidth&&(this._popperOptions.afterUpdate=(t,e)=>{const n=i.width(e,s.BORDER_BOX);i.setStyle(t,"width",n)},this._popperOptions.beforeUpdate=t=>{i.setStyle(t,"width","")})},_renderPlaceholder(){this._placeholder=i.create("span",{html:this._placeholderText?this._settings.sanitize(this._placeholderText):"&nbsp;",class:this.constructor.classes.placeholder})},_renderResults(t){if(!t.length)return this._renderInfo(this._settings.lang.noResults);for(const e of t){const t=this._renderItem(e);i.append(this._itemsList,t)}if(i.findOne("[data-ui-focus]",this._itemsList))return;let e=i.findOne("[data-ui-active]",this._itemsList);e||(e=i.findOne('[data-ui-action="select"]',this._itemsList)),e&&(i.addClass(e,this.constructor.classes.focus),i.setDataset(e,"uiFocus",!0))},_renderSelection(t){const e=i.create("div",{class:this.constructor.classes.tagGroup}),s=this._settings.renderSelection(t.value),n=i.create("div",{html:this._settings.sanitize(s),class:this.constructor.classes.tagItem});if(i.append(e,n),this._settings.showClear){const t=i.create("div",{html:`<span class="${this.constructor.classes.tagClearIcon}"></span>`,class:this.constructor.classes.tagClear,dataset:{uiAction:"clear"}});i.append(e,t)}return e},_renderToggle(){this._toggle=i.create("div",{class:[i.getAttribute(this._node,"class")||"",this.constructor.classes.tagToggle]}),this._input=i.create("input",{class:this.constructor.classes.tagInput,attributes:{autocomplete:"off"}})}}),Object.assign(o,{_buildOption:t=>i.create("option",{value:t,properties:{selected:!0}}),_parseData(t){return t.map((t=>({value:t,element:this._buildOption(t)})))}}),o.defaults={placeholder:"",lang:{loading:"Loading..",maxSelections:"Selection limit reached.",noResults:"No results"},data:null,getResults:null,isMatch:(t,s)=>{const i=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=e.escapeRegExp(s),a=new RegExp(n,"i");return a.test(t)||a.test(i)},renderResult:t=>t,renderSelection:t=>t,sanitize:t=>i.sanitize(t),sortResults:(t,e)=>t.sort(((t,s)=>{const i=t.value.toLowerCase(),n=s.value.toLowerCase();if(e){const t=i.indexOf(e)-n.indexOf(e);if(t)return t}return i.localeCompare(n)})),validTag:t=>!!t,maxSelections:0,minSearch:1,confirmKeys:[","," "],confirmOnBlur:!0,clearOnBlur:!0,showClear:!0,closeOnSelect:!0,debounceInput:250,duration:100,appendTo:null,fullWidth:!1,placement:"bottom",position:"start",fixed:!1,spacing:0,minContact:!1},o.classes={action:"tagsinput-action",active:"tagsinput-active",disabled:"disabled",disabledItem:"tagsinput-disabled",focus:"tagsinput-focus",hide:"visually-hidden",info:"tagsinput-item text-secondary",item:"tagsinput-item",items:"tagsinput-items",menu:"tagsinput-menu shadow-sm",placeholder:"tagsinput-placeholder",tagClear:"btn btn-sm btn-info",tagClearIcon:"btn-close btn-close-white pe-none",tagGroup:"btn-group",tagInput:"tagsinput-input",tagItem:"btn btn-sm btn-info",tagToggle:"tagsinput d-flex flex-wrap position-relative text-start",readonly:"readonly"},n.initComponent("tagsinput",o),n.TagsInput=o}));